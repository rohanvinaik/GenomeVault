from typing import Any, Dict

import pythoncom
from win32com.server.policy import DesignatedWrapPolicy
from win32com.shell import shell, shellcon

# Sample implementation of IFileOperationProgressSink that just prints
# some basic info



class FileOperationProgressSink(DesignatedWrapPolicy):
    _com_interfaces_ = [shell.IID_IFileOperationProgressSink]
    _public_methods_ = [
        "StartOperations",
        "FinishOperations",
        "PreRenameItem",
        "PostRenameItem",
        "PreMoveItem",
        "PostMoveItem",
        "PreCopyItem",
        "PostCopyItem",
        "PreDeleteItem",
        "PostDeleteItem",
        "PreNewItem",
        "PostNewItem",
        "UpdateProgress",
        "ResetTimer",
        "PauseTimer",
        "ResumeTimer",
    ]

    def __init__(self) -> None:
            """TODO: Add docstring for __init__"""
    self._wrap_(self)
        self.newItem = None

    def PreDeleteItem(self, flags, item) -> None:
            """TODO: Add docstring for PreDeleteItem"""
    # Can detect cases where to stop via flags and condition below, however the operation
        # does not actual stop, we can resort to raising an exception as that does stop things
        # but that may need some additional considerations before implementing.
        return 0 if flags & shellcon.TSF_DELETE_RECYCLE_IF_POSSIBLE else 0x80004005  # S_OK, or E_FAIL

    def PostDeleteItem(self, flags, item, hr_delete, newly_created) -> None:
            """TODO: Add docstring for PostDeleteItem"""
    if newly_created:
            self.newItem = newly_created.GetDisplayName(shellcon.SHGDN_FORPARSING)


def create_sink() -> Dict[str, Any]:
        """TODO: Add docstring for create_sink"""
    return pythoncom.WrapObject(FileOperationProgressSink(), shell.IID_IFileOperationProgressSink)

