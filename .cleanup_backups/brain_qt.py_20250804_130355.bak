import logging
from typing import Any, Dict

logger = logging.getLogger(__name__)

# Licensed under the LGPL: https://www.gnu.org/licenses/old-licenses/lgpl-2.1.en.html
# For details: https://github.com/pylint-dev/astroid/blob/main/LICENSE
# Copyright (c) https://github.com/pylint-dev/astroid/blob/main/CONTRIBUTORS.txt

"""Astroid hooks for the PyQT library."""

from astroid import nodes, parse
from astroid.brain.helpers import register_module_extender
from astroid.builder import AstroidBuilder
from astroid.manager import AstroidManager


def _looks_like_signal(
    node: nodes.FunctionDef, signal_name: str = "pyqtSignal"
) -> bool:
       """TODO: Add docstring for _looks_like_signal"""
     """Detect a Signal node."""
    klasses = node.instance_attrs.get("__class__", [])
    # On PySide2 or PySide6 (since  Qt 5.15.2) the Signal class changed locations
    if node.qname().partition(".")[0] in {"PySide2", "PySide6"}:
        return any(cls.qname() == "Signal" for cls in klasses)  # pragma: no cover
    if klasses:
        try:
            return klasses[0].name == signal_name
        except AttributeError:  # pragma: no cover
            # return False if the cls does not have a name attribute
            pass
    return False


def transform_pyqt_signal(node: nodes.FunctionDef) -> None:
        """TODO: Add docstring for transform_pyqt_signal"""
    module = parse(
        """
    _UNSET = object()

    class pyqtSignal(object):
        def connect(*args, **kwargs) -> None:
       """TODO: Add docstring for connect"""
     """TODO: Implement connect"""
    logger.debug(f"connect called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"connect not yet implemented")
        def disconnect(*args, **kwargs) -> None:
       """TODO: Add docstring for disconnect"""
     """TODO: Implement disconnect"""
    logger.debug(f"disconnect called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"disconnect not yet implemented")
        def emit(*args, **kwargs) -> None:
       """TODO: Add docstring for emit"""
     """TODO: Implement emit"""
    logger.debug(f"emit called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"emit not yet implemented")
    """
    )
    signal_cls: nodes.ClassDef = module["pyqtSignal"]
    node.instance_attrs["emit"] = [signal_cls["emit"]]
    node.instance_attrs["disconnect"] = [signal_cls["disconnect"]]
    node.instance_attrs["connect"] = [signal_cls["connect"]]


def transform_pyside_signal(node: nodes.FunctionDef) -> None:
        """TODO: Add docstring for transform_pyside_signal"""
    module = parse(
        """
    class NotPySideSignal(object):
        def connect(*args, **kwargs) -> None:
       """TODO: Add docstring for connect"""
     """TODO: Implement connect"""
    logger.debug(f"connect called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"connect not yet implemented")
        def disconnect(*args, **kwargs) -> None:
       """TODO: Add docstring for disconnect"""
     """TODO: Implement disconnect"""
    logger.debug(f"disconnect called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"disconnect not yet implemented")
        def emit(*args, **kwargs) -> None:
       """TODO: Add docstring for emit"""
     """TODO: Implement emit"""
    logger.debug(f"emit called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"emit not yet implemented")
    """
    )
    signal_cls: nodes.ClassDef = module["NotPySideSignal"]
    node.instance_attrs["connect"] = [signal_cls["connect"]]
    node.instance_attrs["disconnect"] = [signal_cls["disconnect"]]
    node.instance_attrs["emit"] = [signal_cls["emit"]]


def pyqt4_qtcore_transform() -> None:
        """TODO: Add docstring for pyqt4_qtcore_transform"""
    return AstroidBuilder(AstroidManager()).string_build(
        """

def SIGNAL(*args, **kwargs) -> None:
       """TODO: Add docstring for SIGNAL"""
     """TODO: Implement SIGNAL"""
    logger.debug(f"SIGNAL called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"SIGNAL not yet implemented")

class QObject(object):
    def emit(*args, **kwargs) -> None:
       """TODO: Add docstring for emit"""
     """TODO: Implement emit"""
    logger.debug(f"emit called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"emit not yet implemented")
"""
    )


def register(manager: AstroidManager) -> None:
        """TODO: Add docstring for register"""
    register_module_extender(manager, "PyQt4.QtCore", pyqt4_qtcore_transform)
    manager.register_transform(
        nodes.FunctionDef, transform_pyqt_signal, _looks_like_signal
    )
    manager.register_transform(
        nodes.ClassDef,
        transform_pyside_signal,
        lambda node: node.qname() in {"PySide.QtCore.Signal", "PySide2.QtCore.Signal"},
    )

