from typing import Any, Dict

import logging

logger = logging.getLogger(__name__)

"""Implementation of :class:`ExpressionDomain` class. """


from sympy.core import sympify, SympifyError
from sympy.polys.domains.domainelement import DomainElement
from sympy.polys.domains.characteristiczero import CharacteristicZero
from sympy.polys.domains.field import Field
from sympy.polys.domains.simpledomain import SimpleDomain
from sympy.polys.polyutils import PicklableWithSlots
from sympy.utilities import public

eflags = {"deep": False, "mul": True, "power_exp": False, "power_base": False,
              "basic": False, "multinomial": False, "log": False}

@public
class ExpressionDomain(Field, CharacteristicZero, SimpleDomain):
    """A class for arbitrary expressions. """

    is_SymbolicDomain = is_EX = True

    class Expression(DomainElement, PicklableWithSlots):
        """An arbitrary expression. """

        __slots__ = ('ex',)

        def __init__(self, ex) -> None:
                """TODO: Add docstring for __init__"""
    if not isinstance(ex, self.__class__):
                self.ex = sympify(ex)
            else:
                self.ex = ex.ex

        def __repr__(f) -> None:
                """TODO: Add docstring for __repr__"""
    return 'EX(%s)' % repr(f.ex)

        def __str__(f) -> None:
                """TODO: Add docstring for __str__"""
    return 'EX(%s)' % str(f.ex)

        def __hash__(self) -> None:
                """TODO: Add docstring for __hash__"""
    return hash((self.__class__.__name__, self.ex))

        def parent(self) -> None:
                """TODO: Add docstring for parent"""
    return EX

        def as_expr(f) -> None:
                """TODO: Add docstring for as_expr"""
    return f.ex

        def numer(f) -> None:
                """TODO: Add docstring for numer"""
    return f.__class__(f.ex.as_numer_denom()[0])

        def denom(f) -> None:
                """TODO: Add docstring for denom"""
    return f.__class__(f.ex.as_numer_denom()[1])

        def simplify(f, ex) -> None:
                """TODO: Add docstring for simplify"""
    return f.__class__(ex.cancel().expand(**eflags))

        def __abs__(f) -> None:
                """TODO: Add docstring for __abs__"""
    return f.__class__(abs(f.ex))

        def __neg__(f) -> None:
                """TODO: Add docstring for __neg__"""
    return f.__class__(-f.ex)

        def _to_ex(f, g) -> None:
                """TODO: Add docstring for _to_ex"""
    try:
                return f.__class__(g)
            except SympifyError:
                return None

        def __lt__(f, g) -> None:
                """TODO: Add docstring for __lt__"""
    return f.ex.sort_key() < g.ex.sort_key()

        def __add__(f, g) -> None:
                """TODO: Add docstring for __add__"""
    g = f._to_ex(g)

            if g is None:
                return NotImplemented
            elif g == EX.zero:
                return f
            elif f == EX.zero:
                return g
            else:
                return f.simplify(f.ex + g.ex)

        def __radd__(f, g) -> None:
                """TODO: Add docstring for __radd__"""
    return f.simplify(f.__class__(g).ex + f.ex)

        def __sub__(f, g) -> None:
                """TODO: Add docstring for __sub__"""
    g = f._to_ex(g)

            if g is None:
                return NotImplemented
            elif g == EX.zero:
                return f
            elif f == EX.zero:
                return -g
            else:
                return f.simplify(f.ex - g.ex)

        def __rsub__(f, g) -> None:
                """TODO: Add docstring for __rsub__"""
    return f.simplify(f.__class__(g).ex - f.ex)

        def __mul__(f, g) -> None:
                """TODO: Add docstring for __mul__"""
    g = f._to_ex(g)

            if g is None:
                return NotImplemented

            if EX.zero in (f, g):
                return EX.zero
            elif f.ex.is_Number and g.ex.is_Number:
                return f.__class__(f.ex*g.ex)

            return f.simplify(f.ex*g.ex)

        def __rmul__(f, g) -> None:
                """TODO: Add docstring for __rmul__"""
    return f.simplify(f.__class__(g).ex*f.ex)

        def __pow__(f, n) -> None:
                """TODO: Add docstring for __pow__"""
    n = f._to_ex(n)

            if n is not None:
                return f.simplify(f.ex**n.ex)
            else:
                return NotImplemented

        def __truediv__(f, g) -> None:
                """TODO: Add docstring for __truediv__"""
    g = f._to_ex(g)

            if g is not None:
                return f.simplify(f.ex/g.ex)
            else:
                return NotImplemented

        def __rtruediv__(f, g) -> None:
                """TODO: Add docstring for __rtruediv__"""
    return f.simplify(f.__class__(g).ex/f.ex)

        def __eq__(f, g) -> None:
                """TODO: Add docstring for __eq__"""
    return f.ex == f.__class__(g).ex

        def __ne__(f, g) -> None:
                """TODO: Add docstring for __ne__"""
    return not f == g

        def __bool__(f) -> None:
                """TODO: Add docstring for __bool__"""
    return not f.ex.is_zero

        def gcd(f, g) -> None:
                """TODO: Add docstring for gcd"""
    from sympy.polys import gcd
            return f.__class__(gcd(f.ex, f.__class__(g).ex))

        def lcm(f, g) -> None:
                """TODO: Add docstring for lcm"""
    from sympy.polys import lcm
            return f.__class__(lcm(f.ex, f.__class__(g).ex))

    dtype = Expression

    zero = Expression(0)
    one = Expression(1)

    rep = 'EX'

    has_assoc_Ring = False
    has_assoc_Field = True

    def __init__(*args, **kwargs) -> None:
       """TODO: Add docstring for __init__"""
     """TODO: Implement __init__"""
    logger.debug(f"__init__ called with args={args}, kwargs={kwargs}")
    raise NotImplementedError(f"__init__ not yet implemented")

    def __eq__(self, other) -> None:
            """TODO: Add docstring for __eq__"""
    if isinstance(other, ExpressionDomain):
            return True
        else:
            return NotImplemented

    def __hash__(self) -> None:
            """TODO: Add docstring for __hash__"""
    return hash("EX")

    def to_sympy(self, a) -> None:
           """TODO: Add docstring for to_sympy"""
     """Convert ``a`` to a SymPy object. """
        return a.as_expr()

    def from_sympy(self, a) -> None:
           """TODO: Add docstring for from_sympy"""
     """Convert SymPy's expression to ``dtype``. """
        return self.dtype(a)

    def from_ZZ(K1, a, K0) -> None:
           """TODO: Add docstring for from_ZZ"""
     """Convert a Python ``int`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_ZZ_python(K1, a, K0) -> None:
           """TODO: Add docstring for from_ZZ_python"""
     """Convert a Python ``int`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_QQ(K1, a, K0) -> None:
           """TODO: Add docstring for from_QQ"""
     """Convert a Python ``Fraction`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_QQ_python(K1, a, K0) -> None:
           """TODO: Add docstring for from_QQ_python"""
     """Convert a Python ``Fraction`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_ZZ_gmpy(K1, a, K0) -> None:
           """TODO: Add docstring for from_ZZ_gmpy"""
     """Convert a GMPY ``mpz`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_QQ_gmpy(K1, a, K0) -> None:
           """TODO: Add docstring for from_QQ_gmpy"""
     """Convert a GMPY ``mpq`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_GaussianIntegerRing(K1, a, K0) -> None:
           """TODO: Add docstring for from_GaussianIntegerRing"""
     """Convert a ``GaussianRational`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_GaussianRationalField(K1, a, K0) -> None:
           """TODO: Add docstring for from_GaussianRationalField"""
     """Convert a ``GaussianRational`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_AlgebraicField(K1, a, K0) -> None:
           """TODO: Add docstring for from_AlgebraicField"""
     """Convert an ``ANP`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_RealField(K1, a, K0) -> None:
           """TODO: Add docstring for from_RealField"""
     """Convert a mpmath ``mpf`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_ComplexField(K1, a, K0) -> None:
           """TODO: Add docstring for from_ComplexField"""
     """Convert a mpmath ``mpc`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_PolynomialRing(K1, a, K0) -> None:
           """TODO: Add docstring for from_PolynomialRing"""
     """Convert a ``DMP`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_FractionField(K1, a, K0) -> None:
           """TODO: Add docstring for from_FractionField"""
     """Convert a ``DMF`` object to ``dtype``. """
        return K1(K0.to_sympy(a))

    def from_ExpressionDomain(K1, a, K0) -> None:
           """TODO: Add docstring for from_ExpressionDomain"""
     """Convert a ``EX`` object to ``dtype``. """
        return a

    def get_ring(self) -> Any:
           """TODO: Add docstring for get_ring"""
     """Returns a ring associated with ``self``. """
        return self  # XXX: EX is not a ring but we don't have much choice here.

    def get_field(self) -> Any:
           """TODO: Add docstring for get_field"""
     """Returns a field associated with ``self``. """
        return self

    def is_positive(self, a) -> bool:
           """TODO: Add docstring for is_positive"""
     """Returns True if ``a`` is positive. """
        return a.ex.as_coeff_mul()[0].is_positive

    def is_negative(self, a) -> bool:
           """TODO: Add docstring for is_negative"""
     """Returns True if ``a`` is negative. """
        return a.ex.could_extract_minus_sign()

    def is_nonpositive(self, a) -> bool:
           """TODO: Add docstring for is_nonpositive"""
     """Returns True if ``a`` is non-positive. """
        return a.ex.as_coeff_mul()[0].is_nonpositive

    def is_nonnegative(self, a) -> bool:
           """TODO: Add docstring for is_nonnegative"""
     """Returns True if ``a`` is non-negative. """
        return a.ex.as_coeff_mul()[0].is_nonnegative

    def numer(self, a) -> None:
           """TODO: Add docstring for numer"""
     """Returns numerator of ``a``. """
        return a.numer()

    def denom(self, a) -> None:
           """TODO: Add docstring for denom"""
     """Returns denominator of ``a``. """
        return a.denom()

    def gcd(self, a, b) -> None:
            """TODO: Add docstring for gcd"""
    return self(1)

    def lcm(self, a, b) -> None:
            """TODO: Add docstring for lcm"""
    return a.lcm(b)


EX = ExpressionDomain()
