from genomevault.governance.access import AccessController
from genomevault.governance.consent import ConsentRegistry
from genomevault.governance.policy import PolicyEngine


def test_policy_access_and_consent_smoke():
    pol = PolicyEngine()
    acc = AccessController(policy_engine=pol)
    cons = ConsentRegistry()
    user = "user-1"
    dataset = "cohort-A"
    cons.grant(user, dataset)
    assert cons.has(user, dataset)
    decision = acc.check(user=user, resource=dataset, action="read")
    assert decision.allowed in (True, False)  # smoke test (policy config dependent)



