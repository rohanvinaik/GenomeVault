from genomevault.ledger.store import Ledger


def test_append_only_and_hash_chain():
    led = Ledger()
    e1 = led.append({"event": "a", "meta": {}})
    e2 = led.append({"event": "b", "meta": {}})
    assert e1.index == 0 and e2.index == 1
    assert e2.prev_hash == e1.hash
    # tamper detection (hash should change if we recompute with different data)
    h_old = e2.hash
    # simulate recompute: should not equal old if inputs differ
    assert h_old != led._compute_hash(
        e2.index, e2.timestamp, {"event": "b", "meta": {"x": 1}}, e2.prev_hash
    )





