from fastapi.testclient import TestClient

from genomevault.api.app import app

client = TestClient(app)


def test_proofs_create_and_verify():
    r = client.post(
        "/proofs/create", json={"circuit_type": "diabetes_risk", "inputs": {"a": 1}}
    )
    assert r.status_code == 200
    payload = r.json()
    r2 = client.post(
        "/proofs/verify",
        json={"proof": payload["proof"], "public_inputs": payload["public_inputs"]},
    )
    assert r2.status_code == 200
    assert r2.json()["valid"] is True


def test_proofs_verify_rejects_tamper():
    r = client.post(
        "/proofs/create", json={"circuit_type": "prs", "inputs": {"a": 1}}
    ).json()
    bad = {"proof": r["proof"], "public_inputs": {"commitment": "AAAA"}}
    r2 = client.post("/proofs/verify", json=bad)
    assert r2.status_code == 200
    assert r2.json()["valid"] is False


