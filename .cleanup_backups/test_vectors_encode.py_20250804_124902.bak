from fastapi.testclient import TestClient

from genomevault.api.app import app
from genomevault.core.constants import HYPERVECTOR_DIMENSIONS

client = TestClient(app)


def test_vectors_encode_happy_path():
    dim = HYPERVECTOR_DIMENSIONS["base"]
    payload = {
        "data": {"genomic": [1.0, 2.0, 3.0]},
        "dimension": str(dim),
        "compression_tier": "mini",
    }
    r = client.post("/vectors/encode", json=payload)
    assert r.status_code == 200
    j = r.json()
    assert j["dimension"] == dim and "vector_id" in j


def test_vectors_encode_bad_dim():
    payload = {
        "data": {"genomic": [1.0, 2.0, 3.0]},
        "dimension": "99999",
        "compression_tier": "mini",
    }
    r = client.post("/vectors/encode", json=payload)
    assert r.status_code == 400

