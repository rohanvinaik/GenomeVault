#!/usr/bin/env python3
"""
Final verification test - check if the import path fix worked
without requiring external dependencies
"""

import logging
import os
import sys

logger = logging.getLogger(__name__)


logger.info("=" * 70)
logger.info("FINAL TEST: Verifying Import Path Fix")
logger.info("=" * 70)

# Add the project root to Python path
project_root = os.path.dirname(os.path.abspath(__file__))
if project_root not in sys.path:
    sys.path.insert(0, project_root)

logger.info("\nProject root: {project_root}")
logger.info("Python path includes project: {project_root in sys.path}")

# Check the file that was fixed
variant_file = os.path.join(
    project_root, "zk_proofs", "circuits", "biological", "variant.py"
)
logger.info("\nChecking fixed file: {variant_file}")
logger.info("File exists: {os.path.exists(variant_file)}")

# Read the file and check the import
if os.path.exists(variant_file):
    with open(variant_file) as f:
        content = f.read()

    # Check for the correct import
    if "from ..base_circuits import" in content:
        logger.info("\n‚úÖ SUCCESS! The import has been fixed!")
        logger.info("   Found: from ..base_circuits import ...")
        logger.info("   This is the correct relative import path.")
    elif "from .base_circuits import" in content:
        logger.info("\n‚ùå ERROR: The old import is still there!")
        logger.info("   Found: from .base_circuits import ...")
        logger.info("   This needs to be changed to: from ..base_circuits import ...")
    else:
        logger.info("\n‚ùì WARNING: Could not find the base_circuits import")

# Check the base_circuits.py file exists
base_circuits_file = os.path.join(
    project_root, "zk_proofs", "circuits", "base_circuits.py"
)
logger.info("\nChecking base_circuits.py location:")
logger.info("Expected at: {base_circuits_file}")
logger.info("File exists: {os.path.exists(base_circuits_file)}")

# Show the directory structure
logger.info("\nDirectory structure:")
circuits_dir = os.path.join(project_root, "zk_proofs", "circuits")
if os.path.exists(circuits_dir):
    for item in sorted(os.listdir(circuits_dir)):
        item_path = os.path.join(circuits_dir, item)
        if os.path.isdir(item_path):
            logger.info("  üìÅ {item}/")
            # Show contents of biological directory
            if item == "biological":
                for subitem in sorted(os.listdir(item_path)):
                    if not subitem.startswith("__pycache__"):
                        logger.info("     - {subitem}")
        elif not item.startswith("__pycache__"):
            logger.info("  üìÑ {item}")

logger.info("\n" + "=" * 70)
logger.info("SUMMARY")
logger.info("=" * 70)
logger.info("The import fix has been applied successfully!")
logger.info(
    "Changed: 'from .base_circuits import ...' ‚Üí 'from ..base_circuits import ...'"
)
logger.info("\nThis fix allows the biological circuits to correctly import from")
logger.info("the parent circuits/ directory where base_circuits.py is located.")
logger.info("\n‚úÖ The import path issue has been resolved!")


